# Migrating from SharedPreferences to Supabase

This project is being migrated from using SharedPreferences for local storage to Supabase for cloud-based data storage.

## Completed Steps

1. Created a Supabase schema with the following tables:
   - `users` - Stores both students and lecturers
   - `students` - Stores student-specific information
   - `lecturers` - Stores lecturer-specific information
   - `sessions` - Stores class sessions created by lecturers
   - `attendance` - Records student attendance for sessions
   - `user_preferences` - Stores user settings like dark mode
   - `qr_codes` - Stores QR codes generated by lecturers

2. Set up Row-Level Security (RLS) policies for each table to ensure users can only access their own data.

3. Created a `SupabaseService` class that provides methods to:
   - Authenticate users (students and lecturers)
   - Manage user preferences (dark mode, etc.)
   - Handle user data (profile updates, image uploads)
   - Manage attendance data and QR codes

4. Implemented Supabase initialization in the app startup process.

5. Started migrating screens from SharedPreferences to Supabase:
   - Login screen
   - Student dashboard

## Next Steps to Complete Migration

### 1. Update remaining screens

The following screens still need to be updated to use the Supabase service instead of SharedPreferences:

- Lecturer dashboard
- Student signup screen
- Lecturer signup screen
- Profile update screens
- QR code scanning and generation screens
- Attendance history screens
- Settings screens

### 2. Execute Supabase Schema

1. Go to the Supabase dashboard: https://supabase.com/dashboard/project/vaaqnexxyzzmjwquhpry/sql/new
2. Paste and execute the contents of `supabase_schema.sql` to create all tables and policies

### 3. Configure Supabase Keys

1. Replace the placeholder `YOUR_PUBLIC_ANON_KEY` in the following files with your actual Supabase public anon key:
   - `lib/services/supabase_init.dart`
   - `lib/services/supabase_service.dart`

2. You can find your Supabase URL and anon key in the Supabase dashboard under Project Settings > API.

### 4. Add Required Methods to SupabaseService

The following methods need to be implemented in the `SupabaseService` class:

- `getUserData()` - Used in the student dashboard to check for QR codes and notifications
- Add more attendance-related methods for the lecturer side
- Add methods for managing timetables

### 5. Test Migration

1. Test the student flow:
   - Signup
   - Login
   - Profile update
   - QR code scanning
   - Viewing attendance

2. Test the lecturer flow:
   - Signup
   - Login
   - Profile update
   - QR code generation
   - Viewing student attendance

### 6. Full App Testing

Once all screens have been migrated, thoroughly test the full application to ensure:

- Authentication works correctly
- User data is properly stored and retrieved
- Attendance marking functions as expected
- Dark mode and other preferences are saved
- QR code generation and scanning works
- No data loss compared to the previous SharedPreferences implementation

### 7. Remove SharedPreferences Package

After confirming all functionality works with Supabase, remove the SharedPreferences package from `pubspec.yaml` if it's no longer needed.

## Architecture Changes

- Data is now stored in the cloud instead of locally
- Authentication is managed through Supabase
- User session data is kept in memory during app use and synchronized with Supabase
- Profile images are stored in Supabase Storage instead of local files

## Benefits of Migration

- Real-time data synchronization across devices
- More secure user authentication
- Better data organization with proper database schema
- Improved scalability
- Access to analytics and monitoring through Supabase dashboard 